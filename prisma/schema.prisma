generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["qrorder"]
}

model customisation_options {
  option_id              Int                      @id(map: "CUSTOMISATION_OPTIONS_pkey") @default(autoincrement())
  option_name            String                   @db.VarChar(255)
  restaurant_id          Int
  restaurants            restaurants              @relation(fields: [restaurant_id], references: [restaurant_id], onDelete: Cascade, map: "CUSTOMISATION_OPTIONS_RestaurantID_fkey")
  dish_available_options dish_available_options[]
  option_values          option_values[]

  @@unique([restaurant_id, option_name], map: "RestaurantIDOptionName")
  @@schema("qrorder")
}

model dish_available_options {
  dish_id               Int
  option_id             Int
  dishes                dishes                @relation(fields: [dish_id], references: [dish_id], onDelete: Cascade, map: "DISH_AVAILABLE_OPTIONS_DishID_fkey")
  customisation_options customisation_options @relation(fields: [option_id], references: [option_id], onDelete: Cascade, map: "DISH_AVAILABLE_OPTIONS_OptionID_fkey")

  @@id([dish_id, option_id], map: "DISH_AVAILABLE_OPTIONS_pkey")
  @@index([option_id], map: "DISH_AVAILABLE_OPTIONS_OptionID_idx")
  @@schema("qrorder")
}

model dish_categories {
  category_id   Int         @id(map: "DISH_CATEGORIES_pkey") @default(autoincrement())
  restaurant_id Int
  category_name String      @default("Uncategorised") @db.VarChar(255)
  restaurants   restaurants @relation(fields: [restaurant_id], references: [restaurant_id], onDelete: Cascade, map: "DISH_CATEGORIES_RestaurantID_fkey")
  dishes        dishes[]

  @@unique([restaurant_id, category_name], map: "RestaurantIDCategoryName")
  @@schema("qrorder")
}

model dishes {
  dish_id                Int                      @id(map: "DISHES_pkey") @default(autoincrement())
  category_id            Int
  dish_name              String                   @unique(map: "DISHES_DishName_key") @db.VarChar(255)
  description            String
  base_price             Decimal                  @db.Decimal(10, 2)
  dish_available_options dish_available_options[]
  dish_categories        dish_categories          @relation(fields: [category_id], references: [category_id], onDelete: SetDefault, map: "DISHES_CategoryID_fkey")
  order_details          order_details[]

  @@index([category_id], map: "DISHES_CategoryID_idx")
  @@schema("qrorder")
}

model option_values {
  value_id                           Int                                  @id(map: "OPTION_VALUES_pkey") @default(autoincrement())
  option_id                          Int
  value_name                         String                               @db.VarChar(255)
  extra_price                        Decimal                              @db.Decimal(10, 2)
  customisation_options              customisation_options                @relation(fields: [option_id], references: [option_id], onDelete: Cascade, map: "OPTION_VALUES_OptionID_fkey")
  order_detail_customisation_options order_detail_customisation_options[]

  @@unique([option_id, value_name], map: "OptionIDValueName")
  @@schema("qrorder")
}

model order_detail_customisation_options {
  value_id        Int
  order_detail_id Int
  order_details   order_details @relation(fields: [order_detail_id], references: [order_detail_id], onDelete: Cascade, map: "ORDER_DETAIL_CUSTOMISATION_OPTIONS_OrderDetailID_fkey")
  option_values   option_values @relation(fields: [value_id], references: [value_id], onDelete: Cascade, map: "ORDER_DETAIL_CUSTOMISATION_OPTIONS_ValueID_fkey")

  @@id([value_id, order_detail_id], map: "ORDER_DETAIL_CUSTOMISATION_OPTIONS_pkey")
  @@index([order_detail_id], map: "ORDER_DETAIL_CUSTOMISATION_OPTIONS_OrderDetailID_idx")
  @@schema("qrorder")
}

model order_details {
  order_detail_id                    Int                                  @id(map: "ORDER_DETAILS_pkey") @default(autoincrement())
  order_id                           Int
  dish_id                            Int
  quantity                           Int
  order_detail_customisation_options order_detail_customisation_options[]
  dishes                             dishes                               @relation(fields: [dish_id], references: [dish_id], map: "ORDER_DETAILS_DishID_fkey")
  orders                             orders                               @relation(fields: [order_id], references: [order_id], onDelete: Cascade, map: "ORDER_DETAILS_OrderID_fkey")

  @@unique([order_id, order_detail_id, dish_id], map: "OrderIDOrderDetailIDDishID")
  @@index([dish_id], map: "ORDER_DETAILS_DishID_idx")
  @@schema("qrorder")
}

model orders {
  order_id      Int             @id(map: "ORDERS_pkey") @default(autoincrement())
  restaurant_id Int
  order_number  Int
  customer_name String          @db.VarChar(255)
  total_price   Decimal         @db.Decimal(10, 2)
  order_time    DateTime        @default(now())
  table_id      Int
  comment       String?
  status        order_status    @default(Pending)
  order_details order_details[]
  restaurants   restaurants     @relation(fields: [restaurant_id], references: [restaurant_id], onDelete: Cascade, map: "ORDERS_RestaurantID_fkey")
  tables        tables          @relation(fields: [table_id], references: [table_id], map: "ORDERS_TableID_fkey")

  @@unique([restaurant_id, order_number], map: "RestaurantIDOrderNumber")
  @@index([table_id], map: "ORDERS_TableID_idx")
  @@schema("qrorder")
}

model restaurants {
  restaurant_id         Int                     @id(map: "RESTAURANTS_pkey") @default(autoincrement())
  name                  String                  @unique(map: "RESTAURANTS_Name_key") @db.VarChar(255)
  email                 String                  @unique(map: "RESTAURANTS_Email_key") @db.VarChar(255)
  phone                 String                  @unique(map: "RESTAURANTS_Phone_key") @db.VarChar(255)
  address               String                  @db.VarChar(255)
  password              String                  @db.VarChar(255)
  is_admin              Boolean                 @default(false)
  summary               String?
  customisation_options customisation_options[]
  dish_categories       dish_categories[]
  orders                orders[]
  tables                tables[]

  @@schema("qrorder")
}

model tables {
  table_id      Int         @id(map: "TABLES_pkey") @default(autoincrement())
  restaurant_id Int
  table_number  String      @db.VarChar(16)
  capacity      Int
  orders        orders[]
  restaurants   restaurants @relation(fields: [restaurant_id], references: [restaurant_id], onDelete: Cascade, map: "TABLES_RestaurantID_fkey")

  @@unique([restaurant_id, table_number], map: "RestaurantIDTableNumber")
  @@schema("qrorder")
}

enum order_status {
  Pending
  Making
  Completed
  Cancelled

  @@schema("qrorder")
}
